<div class="falcon-signature-container">
  <div class="info-box">
    <strong>â„¹ï¸ About this demo:</strong> Enter a seed string to generate deterministic keypairs.
    Signing uses a deterministic RNG seed (all zeros), so the same keypair and message always produce the same
    signature.
    The Hash-to-Point shows the challenge point <code>c = hash(nonce + message)</code> that Falcon verification actually
    checks.
  </div>

  <!-- Generation Section -->
  <div class="generation-section">
    <h2>1ï¸âƒ£ Input Parameters</h2>

    <div class="form-group">
      <label for="seedInput">Seed String (will be hashed to 48 bytes):</label>
      <div class="input-with-button">
        <input type="text" id="seedInput" [(ngModel)]="seedInput" placeholder="Enter any text as seed">
        <!-- <button type="button" class="btn-secondary" (click)="randomizeSeed()">ğŸ² Random Seed</button> -->
      </div>
    </div>

    <div class="form-group">
      <label for="messageInput">Message to Sign:</label>
      <textarea id="messageInput" [(ngModel)]="messageInput"
        rows="3">Hello, Falcon-512! This is a test message.</textarea>
    </div>

    <div class="button-group left">
      <button class="btn btn-primary" (click)="generateSignature()" [disabled]="generating">
        {{ generating ? 'â³ Generating...' : 'ğŸš€ Generate & Sign' }}
      </button>
      <button class="btn btn-secondary" (click)="randomizeSeed()">ğŸ² Random Seed</button>
      <span class="status-text" [class.error]="error" *ngIf="statusMessage">{{ statusMessage }}</span>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="generatedSignature">
    <h2>2ï¸âƒ£ Generated Artifacts</h2>

    <div class="result-grid">
      <div class="result-item">
        <div class="label-row">
          <label>Message SHA256 (Hex)</label>
          <button type="button" class="btn-copy-inline" (click)="copyToClipboard(messageHashHex)"
            title="Copy to clipboard">â</button>
        </div>
        <div class="value-box code-font">{{ messageHashHex }}</div>
      </div>
      <div class="result-item">
        <div class="label-row">
          <label>Signature (Base64)</label>
          <button type="button" class="btn-copy-inline" (click)="copyToClipboard(generatedSignature)"
            title="Copy to clipboard">â</button>
        </div>
        <div class="value-box code-font">{{ generatedSignature | slice:0:50 }}...</div>
      </div>
      <div class="result-item">
        <div class="label-row">
          <label>Public Key (Base64)</label>
          <button type="button" class="btn-copy-inline" (click)="copyToClipboard(generatedPublicKey)"
            title="Copy to clipboard">â</button>
        </div>
        <div class="value-box code-font">{{ generatedPublicKey | slice:0:50 }}...</div>
      </div>
      <div class="result-item highlight">
        <div class="label-row">
          <label>Poseidon Hash of Public Key (Circuit Input)</label>
          <button type="button" class="btn-copy-inline" (click)="copyToClipboard(pkHash)"
            title="Copy to clipboard">â</button>
          <button *ngIf="walletAddress$ | async" type="button" class="btn-lock" (click)="lockAccount()"
            title="Lock Account on Blockchain"
            style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 1.2rem;">ğŸ”’</button>
        </div>
        <div class="value-box code-font">{{ pkHash }}</div>
      </div>
    </div>

    <button type="button" class="btn-text" (click)="showDetails = !showDetails">
      {{ showDetails ? 'ğŸ”½ Hide Details' : 'â–¶ï¸ Show Parsed Details (Coefficients)' }}
    </button>
  </div>

  <hr class="divider" *ngIf="generatedSignature">

  <div class="button-group center" *ngIf="generatedSignature" style="margin-bottom: 20px;">
    <button type="button" class="btn btn-success" (click)="generateAndNavigate()"
      [disabled]="loading || !isFormValid()">
      {{ loading ? 'â³ Processing...' : 'âš¡ Generate ZK Proof' }}
    </button>
    <button *ngIf="walletAddress$ | async" type="button" class="btn btn-primary" (click)="lockAccount()"
      [disabled]="!pkHash" style="margin-left: 15px; background-color: #1f4068; border-color: #1f4068;">
      ğŸ”’ Lock the Account
    </button>
  </div>

  <div class="error-message" *ngIf="error">
    <strong>âŒ Error:</strong> {{ error }}
  </div>

  <!-- Form Section (Prefilled) -->
  <form (ngSubmit)="generateAndNavigate()" #signatureForm="ngForm" [style.display]="showDetails ? 'block' : 'none'">
    <div class="form-section">
      <h2>3ï¸âƒ£ ZKP Circuit Inputs (Parsed)</h2>
      <p class="info-text">These values are automatically extracted from the signature above.</p>

      <div class="form-group">
        <label for="s1">
          s1 - Signature Polynomial (512 coeffs)
        </label>
        <textarea id="s1" name="s1" [(ngModel)]="s1" required rows="4" class="code-font"
          [disabled]="loading"></textarea>
      </div>

      <div class="form-group">
        <label for="h">
          h - Public Key Polynomial (512 coeffs)
        </label>
        <textarea id="h" name="h" [(ngModel)]="h" required rows="4" class="code-font" [disabled]="loading"></textarea>
      </div>

      <div class="form-group">
        <label for="h2p">
          h2p - Hash-to-Point (512 coeffs)
        </label>
        <textarea id="h2p" name="h2p" [(ngModel)]="h2p" required rows="4" class="code-font"
          [disabled]="loading"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="in_tx_hash1">Transaction Hash 1 (Low 128-bit)</label>
          <input type="text" id="in_tx_hash1" name="in_tx_hash1" [(ngModel)]="in_tx_hash1" required class="code-font" />
          <small class="help-text code-font" style="color: #1E5BA8;">{{ getHexValue(in_tx_hash1) }}</small>
        </div>
        <div class="form-group">
          <label for="in_tx_hash2">Transaction Hash 2 (High 128-bit)</label>
          <input type="text" id="in_tx_hash2" name="in_tx_hash2" [(ngModel)]="in_tx_hash2" required class="code-font" />
          <small class="help-text code-font" style="color: #1E5BA8;">{{ getHexValue(in_tx_hash2) }}</small>
        </div>
      </div>
    </div>

  </form>
</div>