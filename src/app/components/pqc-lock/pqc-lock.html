<div class="pqc-lock-container">
    <div class="info-box">
        <strong>â„¹ï¸ PQC Lock:</strong> This performs a post-quantum secure lock.
        Enter a seed to generate your Falcon-512 keys. The "Unlock" action generates a Zero-Knowledge Proof that you
        possess the private key, without checking the key directly.
    </div>

    <div class="generation-section" *ngIf="!isUnlocked">
        <h2>1ï¸âƒ£ Setup Lock</h2>

        <div class="form-group">
            <label for="seed">Private Seed (Enter any text):</label>
            <input type="text" id="seed" [(ngModel)]="seed" placeholder="my-secret-password-123"
                [disabled]="loading || !!privateKey" autocomplete="off">
        </div>

        <div class="button-group left" *ngIf="!privateKey">
            <button class="btn btn-primary" (click)="generateKey()" [disabled]="loading || !seed">
                {{ loading ? 'â³ Generating...' : 'ğŸ—ï¸ Generate Key' }}
            </button>
        </div>

        <div class="auth-status-container" *ngIf="walletAddress$ | async">
            <div class="status-label">Current Status:</div>
            <div class="status-value" [class.authorized]="isAuthorized$ | async"
                [class.locked]="!(isAuthorized$ | async) && (isAuthorized$ | async) !== null">
                <span *ngIf="checkingAuth$ | async">â³ Checking...</span>
                <span *ngIf="!(checkingAuth$ | async)">
                    {{ (isAuthorized$ | async) ? 'ğŸ”“ UNLOCKED' : 'ğŸ”’ LOCKED' }}
                </span>
            </div>
            <button class="btn-refresh" (click)="refreshStatus()" [disabled]="checkingAuth$ | async"
                title="Refresh Status">
                ğŸ”„
            </button>
        </div>

        <div class="key-display" *ngIf="privateKey">
            <div class="result-item highlight">
                <label>Lock ID (Public Key Hash)</label>
                <div class="value-box-wrapper">
                    <div class="value-box code-font">{{ lockId }}</div>
                    <button class="btn-copy-inline" (click)="copyToClipboard(lockId)" title="Copy Lock ID">â</button>
                </div>
            </div>

            <div class="result-item">
                <label>Your Private Key</label>
                <div class="action-row" *ngIf="!isPrivateKeyRevealed">
                    <button class="btn btn-reveal" (click)="toggleRevealPrivateKey()">ğŸ‘ï¸ Reveal Private Key</button>
                </div>
                <div class="value-box-wrapper" *ngIf="isPrivateKeyRevealed">
                    <div class="value-box code-font">{{ privateKeyBase64 | slice:0:60 }}...</div>
                    <button class="btn-copy-inline" (click)="copyToClipboard(privateKeyBase64)"
                        title="Copy Private Key">â</button>
                    <button class="btn-hide-inline" (click)="toggleRevealPrivateKey()" title="Hide">ğŸ‘ï¸â€ğŸ—¨ï¸</button>
                </div>
            </div>

            <div class="action-area" *ngIf="privateKey">
                <p>Keys ready. Perform blockchain action:</p>
                <div class="button-group center">
                    <!-- Shown when account is currently UNLOCKED -->
                    <button class="btn btn-primary" (click)="lock()" *ngIf="isAuthorized$ | async" [disabled]="loading">
                        {{ loading ? 'â³ Processing...' : 'ğŸ”’ PQC LOCK (Protect Account)' }}
                    </button>

                    <!-- Shown when account is currently LOCKED -->
                    <button class="btn btn-success" (click)="unlock()" *ngIf="!(isAuthorized$ | async)"
                        [disabled]="loading">
                        {{ loading ? 'â³ Verifying...' : 'ğŸ”“ PQC UNLOCK (Generate Proof)' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="results-section success-view" *ngIf="isUnlocked">
        <div class="result-box success">
            <div class="result-icon">âœ…</div>
            <div class="result-text">
                <h3>Access Granted</h3>
                <p>Zero-Knowledge Proof verified successfully.</p>
                <p class="meta-info">The lock confirmed you have the private key without ever seeing it.</p>
            </div>
        </div>

        <div class="button-group center">
            <button class="btn btn-secondary" (click)="reset()">ğŸ”’ Lock Again</button>
        </div>
    </div>

    <div class="error-message" *ngIf="error">
        <strong>âŒ Error:</strong> {{ error }}
    </div>

    <div class="status-message" *ngIf="statusMessage && !error && !isUnlocked">
        {{ statusMessage }}
    </div>
</div>